<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper
  PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
  "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="cn.itganhuo.app.dao.ArticleLabelDao">

	<cache />

	<resultMap id="article_label_result" type="ArticleLabel">
		<id property="id" column="F_ID" />
		<result property="articleId" column="F_ARTICLE_ID" />
		<result property="labelId" column="F_LABEL_ID" />
		<result property="userId" column="F_USER_ID" />
		<collection property="labels" ofType="Label" resultMap="label_result" />
	</resultMap>
	
	<resultMap id="label_result" type="Label">
		<id property="id" column="G_ID" />
		<result property="userId" column="G_USER_ID" />
		<result property="name" column="G_NAME" />
		<result property="description" column="G_DESCRIPTION" />
		<result property="postDate" column="G_POST_DATE" />
	</resultMap>
	
	<!-- 保存文章和标签的多对多关系 -->
	<insert id="insert" parameterType="ArticleLabel" useGeneratedKeys="true" keyProperty="ID">
		INSERT INTO T_ARTICLE_LABEL
		<trim prefix="(" suffix=")" suffixOverrides=",">
			<if test="id != null">ID,</if>
			<if test="articleId != null">ARTICLE_ID,</if>
			<if test="labelId != null">LABEL_ID,</if>
			<if test="userId != null">USER_ID,</if>
		</trim>
		<trim prefix="values (" suffix=")" suffixOverrides=",">
			<if test="id != null">#{id},</if>
			<if test="articleId != null">#{articleId},</if>
			<if test="labelId != null">#{labelId},</if>
			<if test="userId != null">#{userId},</if>
		</trim>
	</insert>
	
	<!-- 根据文章主键到文章标签中间表中查询其对应的标签集合 -->
	<select id="getArticleSubjectByArticleId" resultMap="article_label_result" parameterType="String">
		SELECT 
		    F.ID          F_ID,
		    F.ARTICLE_ID  F_ARTICLE_ID,
		    F.FRTICLE_ID  F_FRTICLE_ID,
		    F.LABEL_ID    F_LABEL_ID,
		    F.USER_ID     F_USER_ID,
		    G.ID          G_ID,
		    G.USER_ID     G_USER_ID,
		    G.NAME        G_NAME,
		    G.DESCRIPTION G_DESCRIPTION,
		    G.POST_DATE   G_POST_DATE
		FROM
		    T_ARTICLE_LABEL F 
		    LEFT JOIN T_LABEL G ON F.LABEL_ID = G.ID
		WHERE F.ARTICLE_ID = #{article_id}
	</select>

</mapper>